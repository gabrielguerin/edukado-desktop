<div class="card" id="post_<%= post.id %>">
  <div class="pb-2">
    <div class="card-header pb-0 border-bottom-0" style="min-height: 0rem;">
      <div class="dropdown" style="visibility: hidden;">
        <%= button_tag theme_icon_tag('more'), class: 'nav-link btn btn-icon' %>
      </div>
      <h4><%= link_to post.title, post_path(post) %></h4>
      <div class="dropdown">
        <button class="nav-link btn btn-icon" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><%= theme_icon_tag('more') %></button>
        <div class="dropdown-menu dropdown-menu-right">
          <%= link_to 'Voir la publication', post_path(post), class: 'dropdown-item' %>
          <% if owner?(post) %>
            <%= link_to 'Modifier', edit_post_path(post), class: 'dropdown-item' %>
            <%= link_to 'Supprimer', post, data: { confirm: 'Êtes-vous sûr ?' }, method: :delete, remote: true, class: 'dropdown-item', id: "delete_post_#{post.id}" %>
          <% end %>
          <h6 class="dropdown-header text-muted">Partager</h6>
          <%= link_to "Facebook", "https://www.facebook.com/sharer/sharer.php?u=http://www.edukado.co#{post_path(post)}", class: 'dropdown-item', data: { network: 'facebook' }, target: '_blank' %>
          <%= link_to "Twitter", "https://www.facebook.com/sharer/sharer.php?u=http://www.edukado.co/posts/#{post_path(post)}", class: 'dropdown-item', data: { network: 'facebook' } %>
          <%= link_to "Email", "https://www.facebook.com/sharer/sharer.php?u=https://www.edukado.co/posts/#{post_path(post)}", class: 'dropdown-item', data: { network: 'facebook' } %>
        </div>
      </div>
    </div>
    <div class="text-center border-bottom">
      <% post.tags.each do |tag| %>
        <a href="<%= tag_path(tag) %>" class="badge badge-light" title="<%= tag.title %>">#<%= tag.title %></a>
      <% end %>
      <div class="my-3">
      <% if user_signed_in? %>
        <% if current_user.points < 50 %>
          <p>Vous n'avez pas assez de points pour accéder à ce contenu.</p>
        <% else %>
          <% if post.file.attached? %>
            <a href="<%= rails_blob_path(post.file, disposition: "attachment") %>" class="btn btn-circle btn-icon btn-border-2x btn-outline-dark mr-2" style="padding-top: 0.5rem; height: 2.375rem; width: 2.375rem;"><i class="ti-download"></i></a><%= post.file.filename %>
          <% else %>
            <p>Il n'y a aucun fichier attaché</p>
          <% end %>
        <% end %>
      <% else %>
        Connectez ou inscrivez-vous pour accéder à ce fichier
      <% end %>
      </div>
    </div>
  </div>
  <div class="card-body pb-0 pt-3">
    <ul class="list-group list-group-flush">
      <li class="list-group-item d-flex pb-0 px-0">
        <div class="mr-auto d-flex align-items-center">
          <%= link_to image_tag(user_avatar(post.user), class: 'rounded-circle mr-1', style: 'object-fit: cover;', width: '64', height: '64', alt: 'profile picture'), posts_user_path(post.user) %>
          <div class="mr-auto d-flex flex-column">
            <h6 class="mb-0"><%= link_to "#{post.user.first_name} #{post.user.last_name}", posts_user_path(post.user) %></h6>
            <small>
              <time>Il y a <%= time_ago_in_words(post.created_at) %></time>
            </small>
          </div>
        </div>
      </li>
      <li class="list-group-item d-flex pt-0 px-0 border-top-0 border-bottom">
        <p class="mt-1 mb-1 text-break pb-3"><%= post.description %></p>
      </li>
    </ul>
  </div>
  <div class="btn-group d-flex" style="min-height: 0rem;">
  <% if user_signed_in? %>
    <% if current_user.liked? post %>
      <%= link_to unlike_post_path(post), remote: true, id: "like_post_#{post.id}", class: 'btn btn-light border-bottom text-success', style: 'font-size: 16px;' do %>
        <div class="d-flex justify-content-center align-items-center">
          <%= theme_icon_tag('arrow-up') %>
          <div class="ml-2" id="like_count">Vote positif · <%= post.likes_sum %></div>
        </div>
      <% end %>
    <% else %>
      <%= link_to like_post_path(post), remote: true, id: "like_post_#{post.id}", class: 'btn btn-light border-bottom', style: 'font-size: 16px;' do %>
        <div class="d-flex justify-content-center align-items-center">
          <%= theme_icon_tag('arrow-up') %>
          <div class="ml-2" id="like_count">Vote positif · <%= post.likes_sum %></div>
        </div>
      <% end %>
    <% end %>
    <% if current_user.disliked? post %>
      <%= link_to undislike_post_path(post), remote: true, id: "dislike_post_#{post.id}", class: 'btn btn-light border-bottom text-danger', style: 'font-size: 16px;' do %>
        <div class="d-flex justify-content-center align-items-center">
          <%= theme_icon_tag('arrow-down') %>
          <div class="ml-2" id="dislike_count">Vote négatif · <%= post.dislikes_sum %></div>
        </div>
      <% end %>
    <% else %>
      <%= link_to dislike_post_path(post), remote: true, id: "dislike_post_#{post.id}", class: 'btn btn-light border-bottom', style: 'font-size: 16px;' do %>
        <div class="d-flex justify-content-center align-items-center">
          <%= theme_icon_tag('arrow-down') %>
          <div class="ml-2" id="dislike_count">Vote négatif · <%= post.dislikes_sum %></div>
        </div>
      <% end %>
    <% end %>
    <% else %>
        <%= link_to like_post_path(post), remote: true, id: "like_post_#{post.id}", class: 'btn btn-light border-bottom disabled', style: 'font-size: 16px;' do %>
        <div class="d-flex justify-content-center align-items-center">
          <%= theme_icon_tag('arrow-up') %>
          <div class="ml-2" id="like_count">Vote positif · <%= post.likes_sum %></div>
        </div>
      <% end %>
      <%= link_to dislike_post_path(post), remote: true, id: "dislike_post_#{post.id}", class: 'btn btn-light border-bottom disabled', style: 'font-size: 16px;' do %>
        <div class="d-flex justify-content-center align-items-center">
          <%= theme_icon_tag('arrow-down') %>
          <div class="ml-2" id="dislike_count">Vote négatif · <%= post.dislikes_sum %></div>
        </div>
      <% end %>
    <% end %>
    <%= link_to post_path(post), id: 'new-comment', class: 'btn btn-light border-bottom', style: 'font-size: 16px;' do %>
      <div class="d-flex justify-content-center align-items-center">
        <%= theme_icon_tag('comment') %>
        <div class="ml-2">
          <% if post.comments.count == 0 %>
          Commentaire
          <% else %>
          Commentaires
          <% end %>
           · <%= post.comments.count %>
        </div>
      </div>
    <% end %>
  </div>
  <% unless current_page?(posts_path) || current_page?(posts_user_path(post.user)) %>
    <div class="card-footer d-flex flex-row" style="background-color: #fff">
      <div class="d-flex flex-row w-100">
        <% if user_signed_in? %>
          <%= link_to image_tag(user_avatar(current_user), class: 'rounded-circle mr-2', style: 'object-fit: cover;', width: '40', height: '40'), posts_user_path(current_user) %>
        <% else %>
          <%= image_tag(image_url('fallback/default.png'),  class: 'rounded-circle mr-2', style: 'object-fit: cover;', width: '40', height: '40') %>
        <% end %>
          <div class="w-100" id="new_comment_<%= post.id %>">
            <%= render partial: 'comments/form', locals: { post: post } %>
          </div>
      </div>
    </div>
  <% end %>
  <% if post.comments.present? %>
    <div id="comments_<%= post.id %>">
    <% if current_page?(post_path(post)) %>
      <%= render post.comments.order(created_at: :desc) %>
    <% end %>
    </div>
  <% end %>
</div>
