<div class="card" id="post_<%= post.id %>">
  <div class="pb-2">
    <div class="card-header pb-0 border-bottom-0" style="min-height: 0rem;">
      <div class="dropdown" style="visibility: hidden;">
        <%= button_tag theme_icon_tag('more'), class: 'nav-link btn btn-icon' %>
      </div>
      <%# Title %>
      <h4><%= link_to post.title, post_path(post) %></h4>
      <%# Dropdown menu %>
      <div class="dropdown">
        <button class="nav-link btn btn-icon" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><%= theme_icon_tag('more') %></button>
        <div class="dropdown-menu dropdown-menu-right">
          <%# Show post %>
          <%= link_to 'Voir la publication', post_path(post), class: 'dropdown-item' %>
          <% if owner?(post) %>
            <%# Edit %>
            <%= link_to 'Modifier', edit_post_path(post), class: 'dropdown-item' %>
            <%# Delete %>
            <%= link_to 'Supprimer', post, data: { confirm: 'Êtes-vous sûr ?' }, method: :delete, remote: true, class: 'dropdown-item', id: "delete_post_#{post.id}" %>
          <% end %>
          <%# Share %>
          <h6 class="dropdown-header text-muted">Partager</h6>
          <%= content_tag(:div, class: 'd-flex justify-content-between', style: 'padding: 0 1.5rem;') do %>
            <%# Facebook %>
            <%= link_to("https://www.facebook.com/sharer/sharer.php?u=http://www.edukado.co#{post_path(post)}", data: { network: 'facebook' }, target: '_blank') do %>
              <span style="font-size: 20px"><%= fa_icon_tag('facebook-square') %></span>
            <% end %>
            <%# Twitter %>
            <%= link_to("https://www.facebook.com/sharer/sharer.php?u=http://www.edukado.co#{post_path(post)}", data: { network: 'facebook' }, target: '_blank') do %>
               <span style="font-size: 20px"><%= fa_icon_tag('twitter-square') %></span>
            <% end %>
            <%# Email %>
            <%= link_to("https://www.facebook.com/sharer/sharer.php?u=http://www.edukado.co#{post_path(post)}", data: { network: 'facebook' }, target: '_blank') do %>
              <span style="font-size: 20px"><%= fa_icon_tag('envelope') %></span>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
    <div class="text-center border-bottom pb-4">
      <%# Tags %>
      <% post.tags.each do |tag| %>
        <a href="<%= tag_path(tag) %>" class="badge badge-light" title="<%= tag.title %>">#<%= tag.title %></a>
      <% end %>
    </div>
  </div>
  <div class="card-body pb-0 pt-3">
    <ul class="list-group list-group-flush">
      <li class="list-group-item d-flex pb-0 px-0">
        <div class="mr-auto d-flex align-items-center">
          <%# User avatar %>
          <%= link_to image_tag(user_avatar(post.user), class: 'rounded-circle mr-1', style: 'object-fit: cover;', width: '64', height: '64', alt: 'profile picture'), posts_user_path(post.user) %>
          <div class="mr-auto d-flex flex-column">
            <%# User full name %>
            <h6 class="mb-0"><%= link_to "#{post.user.full_name}", posts_user_path(post.user) %></h6>
            <div class="d-flex align-items-center flex-row ">
              <%= render partial: 'badges/badges_user-info', locals: { user: post.user } %>
            </div>
            <%# Date published %>
            <small>
              <time>Publié il y a <%= time_ago_in_words(post.created_at) %></time>
            </small>
          </div>
        </div>
      </li>
      <li class="list-group-item d-flex pt-0 px-0 border-top-0 border-bottom">
        <%# Description %>
        <p class="mt-1 mb-1 text-break"><%= post.description %></p>
      </li>
      <%# File %>
      <li class="list-group-item d-flex px-0 pt-0 border-0">
      <% if user_signed_in? %>
        <% if current_user.points < 50 %>
          <p>Vous n'avez pas assez de points pour accéder à ce contenu.</p>
        <% else %>
        <% if post.file.attached? %>
          <a href="<%= rails_blob_path(post.file, disposition: "attachment") %>" class='file w-100'>
            <div class="card card-mini card-mini-split inspectable">
              <div class="card-body">
                <div class="media align-items-center">
                  <div class="d-flex align-self-center">
                    <%# Image %>
                    <% if post.file.content_type.include? 'image' %>
                      <i class="ti-image"style="font-size: 25px;"></i>
                      <%# Text %>
                    <% elsif post.file.content_type.include? 'text' %>
                      <i class="ti-text"style="font-size: 25px;"></i>
                      <%# Audio %>
                    <% elsif post.file.content_type.include? 'audio' %>
                      <i class="ti-music-alt"style="font-size: 25px;"></i>
                      <%# Video %>
                    <% elsif post.file.content_type.include? 'video' %>
                      <i class="ti-video-clapper"style="font-size: 25px;"></i>
                      <%# Document %>
                    <% else %>
                      <i class="ti-file"style="font-size: 25px;"></i>
                    <% end %>
                  </div>
                  <div class="media-body text-left" style="padding: 1rem 1.25rem;">
                    <h6 class="m-0"><%= post.file.filename %></h6>
                    <%# Image %>
                    <% if post.file.content_type.include? 'image' %>
                      <span class="text-muted">Image</span>
                      <%# Text %>
                    <% elsif post.file.content_type.include? 'text' %>
                      <span class="text-muted">Text</span>
                      <%# Audio %>
                    <% elsif post.file.content_type.include? 'audio' %>
                      <span class="text-muted">Audio</span>
                      <%# Video %>
                    <% elsif post.file.content_type.include? 'video' %>
                      <span class="text-muted">Video</span>
                      <%# Document %>
                    <% else %>
                      <span class="text-muted">Document</span>
                    <% end %>
                  </div>
                  <div class="px-4 text-muted">
                    <span class="text-muted"><i class="ti-download" style="font-size: 20px; color: #6C757D;"></i></span>
                  </div>
                </div>
              </div>
            </div>
          </a>
        <% else %>
        <p>Il n'y a pas de fichier attaché.</p>
        <% end %>
        <% end %>
      <% else %>
        Connectez ou inscrivez-vous pour accéder à ce fichier
      <% end %>
      </li>
    </ul>
  </div>
  <div class="btn-group d-flex" style="min-height: 0rem;">
    <%= render partial: 'posts/vote', locals: { post: post } %>
  </div>
  <%# Comment section %>
  <% unless current_page?(posts_path) || current_page?(posts_user_path(post.user)) || current_page?(tag_path) %>
      <div class="card-footer d-flex flex-row w-100" style="background-color: #fff">
        <% if user_signed_in? %>
          <%# Current user avatar %>
          <%= link_to image_tag(user_avatar(current_user), class: 'rounded-circle mr-2 d-flex align-items-center', style: 'object-fit: cover; max-height: ', width: '40', height: '40'), posts_user_path(current_user) %>
        <% else %>
          <%= image_tag(image_url('fallback/default.png'),  class: 'rounded-circle mr-2', style: 'object-fit: cover;', width: '40', height: '40') %>
        <% end %>
          <%# Comment form %>
          <div class="w-100" id="new_comment_<%= post.id %>">
            <%= render partial: 'comments/form', locals: { post: post } %>
          </div>
      </div>
  <% end %>
  <%# Comments %>
  <% if post.comments.present? %>
    <div id="comments_<%= post.id %>">
    <% if current_page?(post_path(post)) %>
      <%= render post.comments.order(created_at: :desc) %>
    <% end %>
    </div>
  <% end %>
</div>
